<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Albumes de Kanye West</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/jpeg" href="prelo.jpg">
    <!-- IMPORTAR JQUERY -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>游꿧 Albumes de Kanye West 游꿧</h1>
            <p>Mira todos sus albumes</p>
            <a href="indexform.html" class="nav-btn">Votar Canciones</a>
        </header>

        <!-- DIV FRASES DE KANYE -->
        <div class="quote-section">
            <p class="quote-text">Pulsa aqui para escuchar una frase estupida de Kanye</p>
            <button id="quote-btn" class="quote-btn">Hazme click</button>
            <div id="quote-display" class="quote-display"></div>
        </div>
        
        <!-- Para cargar los albumes, luego en la linea 50 lo veras -->
        <div class="loader">
            <div class="spinner"></div>
            <p>Cargando</p>
        </div>

        <!-- Declaracion de albumes y errores -->
        <div id="albums-container" class="albums-grid"></div>
        <div id="error-container"></div>
    </div>

    <script>
        // Cuando la pagina este lista, se cargaran todos los albumes (los de Kanye, solo he cogido ese artista)
        $(document).ready(function() {
            cargarAlbumes();
            
            // Obtener una frase al pulsar el boton
            $('#quote-btn').click(function() {
                obtenerFrase();
            });
        });

        // FUNCION CARGAR ALBUMES KAYNE
        function cargarAlbumes() {
            $('.loader').show(); //mostrar el div de antes
            
            // API iTunes -> albumes de Kanye West
            var api_Itunes = 'https://itunes.apple.com/search?term=kanye+west&entity=album&limit=200';
            
            // TRAER DATOS Y CONVERTIRLOS A JSON
            fetch(api_Itunes)
                .then(function(respuesta) {
                    return respuesta.json();
                })
                .then(function(datos) {
                    // Ocultar el loader, porque ya han cargado los datos
                    $('.loader').hide();
                    
                    // Comprobante para ver si coge los datos
                    if (datos.results && datos.results.length > 0) {
                        // Array para los albumes unicos
                        var albumes_Unicos = [];
                        // Array para guardar los nombres que ya han salido
                        var albumes_Vistos = [];
                        
                        // Recorrer los resultados
                        for (var i = 0; i < datos.results.length; i++) {
                            var album_Actual = datos.results[i];
                            var nombre_Album = album_Actual.collectionName;
                            
                            // Comprobante para que no sean repetidos
                            if (album_Actual.collectionType === 'Album') {
                                var album_Repetido = false;
                                for (var j = 0; j < albumes_Vistos.length; j++) {
                                    if (albumes_Vistos[j] === nombre_Album) {
                                        album_Repetido = true;
                                        break;
                                    }
                                }
                                
                                // A침adirlo si no existe
                                if (album_Repetido === false) {
                                    albumes_Unicos.push(album_Actual);
                                    albumes_Vistos.push(nombre_Album);
                                }
                            }
                        }
                        
                        // Mostrar los albumes unicos
                        if (albumes_Unicos.length > 0) {
                            mostrar_Albumes(albumes_Unicos);
                        } else {
                            // Si no hay albumes, mostrar mensaje
                            var no_Obtenido = '<div class="no-results">No ha cogido los albumes</div>';
                            $('#albums-container').html(no_Obtenido);
                        }
                    } else {
                        // Si no hay resultados, mostrar mensaje
                        var no_Obtenido2 = '<div class="no-results">No ha cogido los albumes</div>';
                        $('#albums-container').html(no_Obtenido2);
                    }
                })
                .catch(function(error) {
                    // Si hay un error, ocultamos el loader
                    $('.loader').hide();
                    // Mostrar el error en la consola
                    console.log('Hubo un error al cargar los albumes:', error);
                    // Mostrar mensaje de error al usuario
                    var mensaje_Error = '<div class="error">Error al cargar los albumes.</div>';
                    $('#error-container').html(mensaje_Error);
                });
        }

        // FUNCION PARA MOSTRAR ALBUMES
        function mostrar_Albumes(albumes_kayne) {
            // Variable para guardar todo el HTML que vamos a crear
            var html_Completo = '';
            
            // Recorrer cada album uno por uno
            for (var indice = 0; indice < albumes_kayne.length; indice++) {
                // Guardar el album actual en una variable
                var album_Actual = albumes_kayne[indice];
                
                //OBTENER DATOS ALBUM
                // titulo
                var album_Titulo = '';
                if (album_Actual.collectionName) {
                    album_Titulo = album_Actual.collectionName;
                } else {
                    album_Titulo = 'Sin t칤tulo';
                    album_Titulo = 'Sin t칤tulo';
                }
                
                // nombre
                var album_Artista = '';
                if (album_Actual.artistName) {
                    album_Artista = album_Actual.artistName;
                } else {
                    album_Artista = 'Artista desconocido';
                    album_Artista = 'Artista desconocido';
                }
                
                // imagen
                var album_Imagen = '';
                if (album_Actual.artworkUrl100) {
                    // Cambiar el tama침o de la imagen a 250x250
                    album_Imagen = album_Actual.artworkUrl100.replace('100x100', '250x250');
                } else {
                    album_Imagen = '';
                    album_Imagen = '';
                }
                
                // url itunes
                var url_Itunes = '';
                if (album_Actual.collectionViewUrl) {
                    url_Itunes = album_Actual.collectionViewUrl;
                } else {
                    url_Itunes = '#';
                }
                
                // a침o
                var album_A침o = 'N/A';
                if (album_Actual.releaseDate) {
                    var fecha = new Date(album_Actual.releaseDate);
                    album_A침o = fecha.getFullYear();
                }
                
                // numero canciones
                var num_Canciones = 0;
                if (album_Actual.trackCount) {
                    num_Canciones = album_Actual.trackCount;
                }
                
                // TARJETITAS ALBUMES
                var html_Tarjeta_Album = '';
                html_Tarjeta_Album = html_Tarjeta_Album + '<div class="album-card">';
                html_Tarjeta_Album = html_Tarjeta_Album + '<img src="' + album_Imagen + '" alt="' + album_Titulo + '" class="album-image">';
                html_Tarjeta_Album = html_Tarjeta_Album + '<div class="album-info">';
                html_Tarjeta_Album = html_Tarjeta_Album + '<div class="album-title">' + album_Titulo + '</div>';
                html_Tarjeta_Album = html_Tarjeta_Album + '<div class="album-artist">' + album_Artista + '</div>';
                html_Tarjeta_Album = html_Tarjeta_Album + '<div class="album-year">游늰 ' + album_A침o + '</div>';
                html_Tarjeta_Album = html_Tarjeta_Album + '<div class="album-tracks">游꿧 ' + num_Canciones + ' canciones</div>';
                html_Tarjeta_Album = html_Tarjeta_Album + '<a href="' + url_Itunes + '" target="_blank" class="album-link">Ver en iTunes</a>';
                html_Tarjeta_Album = html_Tarjeta_Album + '</div>';
                html_Tarjeta_Album = html_Tarjeta_Album + '</div>';
                
                // A침adir al html completo
                html_Completo = html_Completo + html_Tarjeta_Album;
            }
            
            // A침adirlo al contenedor
            $('#albums-container').html(html_Completo);
        }

        // FUNCION PARA LAS FRASES DE KANYE
        function obtenerFrase() {
            // Desactivar el boton, para que no haga click varias veces
            var boton_Kanye_Frases = $('#quote-btn');
            boton_Kanye_Frases.prop('disabled', true);
            
            // Mostrar mensaje de carga
            var frases_Aviso = $('#quote-display');
            frases_Aviso.text('Cargando frase');
            
            // URL de la API de frases de Kanye
            var api_Frases_Kanye = 'https://api.kanye.rest/';
            
            // Hacer la peticion a la API
            fetch(api_Frases_Kanye)
                .then(function(rep_API) {
                    // Verificar si la respuesta est치 bien
                    if (rep_API.ok === false) {
                        throw new Error('Error en la respuesta');
                    }
                    // Convertir a JSON
                    return rep_API.json();
                })
                .then(function(datos_API) {
                    // Mostrar en consola lo que recibimos
                    console.log('Datos recibidos:', datos_API);
                    
                    // Verificar si hay una frase
                    if (datos_API.quote) {
                        // Modificar la frase
                        var frase_actual = datos_API.quote;
                        var frase_final = '"' + frase_actual + '"';

                        // Mostrar la frase
                        frases_Aviso.text(frase_final);
                    } else {
                        frases_Aviso.text('No se pudo obtener la frase');
                    }
                    
                    // Volver a habilitar el boton
                    boton_Kanye_Frases.prop('disabled', false);
                })
                .catch(function(error_consola) {
                    // Mostrar el error en consola
                    console.error('Error:', error_consola);
                    frases_Aviso.text('Error al obtener la frase. Intenta de nuevo.');
                    boton_Kanye_Frases.prop('disabled', false);
                });
        }
    </script>
</body>
</html>
